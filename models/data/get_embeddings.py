import torchtext
import numpy as np
import os
import torch
import json

vg = {'airplane': 0, 'animal': 1, 'arm': 2, 'bag': 3, 'banana': 4, 'basket': 5, 'beach': 6, 'bear': 7, 'bed': 8, 'bench': 9, 'bike': 10, 'bird': 11, 'board': 12, 'boat': 13, 'book': 14, 'boot': 15, 'bottle': 16, 'bowl': 17, 'box': 18, 'boy': 19, 'branch': 20, 'building': 21, 'bus': 22, 'cabinet': 23, 'cap': 24, 'car': 25, 'cat': 26, 'chair': 27, 'child': 28, 'clock': 29, 'coat': 30, 'counter': 31, 'cow': 32, 'cup': 33, 'curtain': 34, 'desk': 35, 'dog': 36, 'door': 37, 'drawer': 38, 'ear': 39, 'elephant': 40, 'engine': 41, 'eye': 42, 'face': 43, 'fence': 44, 'finger': 45, 'flag': 46, 'flower': 47, 'food': 48, 'fork': 49, 'fruit': 50, 'giraffe': 51, 'girl': 52, 'glass': 53, 'glove': 54, 'guy': 55, 'hair': 56, 'hand': 57, 'handle': 58, 'hat': 59, 'head': 60, 'helmet': 61, 'hill': 62, 'horse': 63, 'house': 64, 'jacket': 65, 'jean': 66, 'kid': 67, 'kite': 68, 'lady': 69, 'lamp': 70, 'laptop': 71, 'leaf': 72, 'leg': 73, 'letter': 74, 'light': 75, 'logo': 76, 'man': 77, 'men': 78, 'motorcycle': 79, 'mountain': 80, 'mouth': 81, 'neck': 82, 'nose': 83, 'number': 84, 'orange': 85, 'pant': 86, 'paper': 87, 'paw': 88, 'people': 89, 'person': 90, 'phone': 91, 'pillow': 92, 'pizza': 93, 'plane': 94, 'plant': 95, 'plate': 96, 'player': 97, 'pole': 98, 'post': 99, 'pot': 100, 'racket': 101, 'railing': 102, 'rock': 103, 'roof': 104, 'room': 105, 'screen': 106, 'seat': 107, 'sheep': 108, 'shelf': 109, 'shirt': 110, 'shoe': 111, 'short': 112, 'sidewalk': 113, 'sign': 114, 'sink': 115, 'skateboard': 116, 'ski': 117, 'skier': 118, 'sneaker': 119, 'snow': 120, 'sock': 121, 'stand': 122, 'street': 123, 'surfboard': 124, 'table': 125, 'tail': 126, 'tie': 127, 'tile': 128, 'tire': 129, 'toilet': 130, 'towel': 131, 'tower': 132, 'track': 133, 'train': 134, 'tree': 135, 'truck': 136, 'trunk': 137, 'umbrella': 138, 'vase': 139, 'vegetable': 140, 'vehicle': 141, 'wave': 142, 'wheel': 143, 'window': 144, 'windshield': 145, 'wing': 146, 'wire': 147, 'woman': 148, 'zebra': 149}

coco = {'person': 0, 'bicycle': 1, 'car': 2, 'motorcycle': 3, 'airplane': 4, 'bus': 5, 'train': 6, 'truck': 7, 'boat': 8, 'traffic light': 9, 'fire hydrant': 10, 'stop sign': 11, 'parking meter': 12, 'bench': 13, 'bird': 14, 'cat': 15, 'dog': 16, 'horse': 17, 'sheep': 18, 'cow': 19, 'elephant': 20, 'bear': 21, 'zebra': 22, 'giraffe': 23, 'backpack': 24, 'umbrella': 25, 'handbag': 26, 'tie': 27, 'suitcase': 28, 'frisbee': 29, 'skis': 30, 'snowboard': 31, 'sports ball': 32, 'kite': 33, 'baseball bat': 34, 'baseball glove': 35, 'skateboard': 36, 'surfboard': 37, 'tennis racket': 38, 'bottle': 39, 'wine glass': 40, 'cup': 41, 'fork': 42, 'knife': 43, 'spoon': 44, 'bowl': 45, 'banana': 46, 'apple': 47, 'sandwich': 48, 'orange': 49, 'broccoli': 50, 'carrot': 51, 'hot dog': 52, 'pizza': 53, 'donut': 54, 'cake': 55, 'chair': 56, 'couch': 57, 'potted plant': 58, 'bed': 59, 'dining table': 60, 'toilet': 61, 'tv': 62, 'laptop': 63, 'mouse': 64, 'remote': 65, 'keyboard': 66, 'cell phone': 67, 'microwave': 68, 'oven': 69, 'toaster': 70, 'sink': 71, 'refrigerator': 72, 'book': 73, 'clock': 74, 'vase': 75, 'scissors': 76, 'teddy bear': 77, 'hair drier': 78, 'toothbrush': 79}

open_images = {'tortoise': 0, 'container': 1, 'magpie': 2, 'sea turtle': 3, 'football': 4, 'ambulance': 5, 'ladder': 6, 'toothbrush': 7, 'syringe': 8, 'sink': 9, 'toy': 10, 'organ (musical instrument)': 11, 'cassette deck': 12, 'apple': 13, 'human eye': 14, 'cosmetics': 15, 'paddle': 16, 'snowman': 17, 'beer': 18, 'chopsticks': 19, 'human beard': 20, 'bird': 21, 'parking meter': 22, 'traffic light': 23, 'croissant': 24, 'cucumber': 25, 'radish': 26, 'towel': 27, 'doll': 28, 'skull': 29, 'washing machine': 30, 'glove': 31, 'tick': 32, 'belt': 33, 'sunglasses': 34, 'banjo': 35, 'cart': 36, 'ball': 37, 'backpack': 38, 'bicycle': 39, 'home appliance': 40, 'centipede': 41, 'boat': 42, 'surfboard': 43, 'boot': 44, 'headphones': 45, 'hot dog': 46, 'shorts': 47, 'fast food': 48, 'bus': 49, 'boy': 50, 'screwdriver': 51, 'bicycle wheel': 52, 'barge': 53, 'laptop': 54, 'miniskirt': 55, 'drill (tool)': 56, 'dress': 57, 'bear': 58, 'waffle': 59, 'pancake': 60, 'brown bear': 61, 'woodpecker': 62, 'blue jay': 63, 'pretzel': 64, 'bagel': 65, 'tower': 66, 'teapot': 67, 'person': 68, 'bow and arrow': 69, 'swimwear': 70, 'beehive': 71, 'brassiere': 72, 'bee': 73, 'bat (animal)': 74, 'starfish': 75, 'popcorn': 76, 'burrito': 77, 'chainsaw': 78, 'balloon': 79, 'wrench': 80, 'tent': 81, 'vehicle registration plate': 82, 'lantern': 83, 'toaster': 84, 'flashlight': 85, 'billboard': 86, 'tiara': 87, 'limousine': 88, 'necklace': 89, 'carnivore': 90, 'scissors': 91, 'stairs': 92, 'computer keyboard': 93, 'printer': 94, 'traffic sign': 95, 'chair': 96, 'shirt': 97, 'poster': 98, 'cheese': 99, 'sock': 100, 'fire hydrant': 101, 'land vehicle': 102, 'earrings': 103, 'tie': 104, 'watercraft': 105, 'cabinetry': 106, 'suitcase': 107, 'muffin': 108, 'bidet': 109, 'snack': 110, 'snowmobile': 111, 'clock': 112, 'medical equipment': 113, 'cattle': 114, 'cello': 115, 'jet ski': 116, 'camel': 117, 'coat': 118, 'suit': 119, 'desk': 120, 'cat': 121, 'bronze sculpture': 122, 'juice': 123, 'gondola': 124, 'beetle': 125, 'cannon': 126, 'computer mouse': 127, 'cookie': 128, 'office building': 129, 'fountain': 130, 'coin': 131, 'calculator': 132, 'cocktail': 133, 'computer monitor': 134, 'box': 135, 'stapler': 136, 'christmas tree': 137, 'cowboy hat': 138, 'hiking equipment': 139, 'studio couch': 140, 'drum': 141, 'dessert': 142, 'wine rack': 143, 'drink': 144, 'zucchini': 145, 'ladle': 146, 'human mouth': 147, 'dairy product': 148, 'dice': 149, 'oven': 150, 'dinosaur': 151, 'ratchet (device)': 152, 'couch': 153, 'cricket ball': 154, 'winter melon': 155, 'spatula': 156, 'whiteboard': 157, 'pencil sharpener': 158, 'door': 159, 'hat': 160, 'shower': 161, 'eraser': 162, 'fedora': 163, 'guacamole': 164, 'dagger': 165, 'scarf': 166, 'dolphin': 167, 'sombrero': 168, 'tin can': 169, 'mug': 170, 'tap': 171, 'harbor seal': 172, 'stretcher': 173, 'can opener': 174, 'goggles': 175, 'human body': 176, 'roller skates': 177, 'coffee cup': 178, 'cutting board': 179, 'blender': 180, 'plumbing fixture': 181, 'stop sign': 182, 'office supplies': 183, 'volleyball (ball)': 184, 'vase': 185, 'slow cooker': 186, 'wardrobe': 187, 'coffee': 188, 'whisk': 189, 'paper towel': 190, 'personal care': 191, 'food': 192, 'sun hat': 193, 'tree house': 194, 'flying disc': 195, 'skirt': 196, 'gas stove': 197, 'salt and pepper shakers': 198, 'mechanical fan': 199, 'face powder': 200, 'fax': 201, 'fruit': 202, 'french fries': 203, 'nightstand': 204, 'barrel': 205, 'kite': 206, 'tart': 207, 'treadmill': 208, 'fox': 209, 'flag': 210, 'french horn': 211, 'window blind': 212, 'human foot': 213, 'golf cart': 214, 'jacket': 215, 'egg (food)': 216, 'street light': 217, 'guitar': 218, 'pillow': 219, 'human leg': 220, 'isopod': 221, 'grape': 222, 'human ear': 223, 'power plugs and sockets': 224, 'panda': 225, 'giraffe': 226, 'woman': 227, 'door handle': 228, 'rhinoceros': 229, 'bathtub': 230, 'goldfish': 231, 'houseplant': 232, 'goat': 233, 'baseball bat': 234, 'baseball glove': 235, 'mixing bowl': 236, 'marine invertebrates': 237, 'kitchen utensil': 238, 'light switch': 239, 'house': 240, 'horse': 241, 'stationary bicycle': 242, 'hammer': 243, 'ceiling fan': 244, 'sofa bed': 245, 'adhesive tape': 246, 'harp': 247, 'sandal': 248, 'bicycle helmet': 249, 'saucer': 250, 'harpsichord': 251, 'human hair': 252, 'heater': 253, 'harmonica': 254, 'hamster': 255, 'curtain': 256, 'bed': 257, 'kettle': 258, 'fireplace': 259, 'scale': 260, 'drinking straw': 261, 'insect': 262, 'hair dryer': 263, 'kitchenware': 264, 'indoor rower': 265, 'invertebrate': 266, 'food processor': 267, 'bookcase': 268, 'refrigerator': 269, 'wood-burning stove': 270, 'punching bag': 271, 'common fig': 272, 'cocktail shaker': 273, 'jaguar (animal)': 274, 'golf ball': 275, 'fashion accessory': 276, 'alarm clock': 277, 'filing cabinet': 278, 'artichoke': 279, 'table': 280, 'tableware': 281, 'kangaroo': 282, 'koala': 283, 'knife': 284, 'bottle': 285, 'bottle opener': 286, 'lynx': 287, 'lavender (plant)': 288, 'lighthouse': 289, 'dumbbell': 290, 'human head': 291, 'bowl': 292, 'humidifier': 293, 'porch': 294, 'lizard': 295, 'billiard table': 296, 'mammal': 297, 'mouse': 298, 'motorcycle': 299, 'musical instrument': 300, 'swim cap': 301, 'frying pan': 302, 'snowplow': 303, 'bathroom cabinet': 304, 'missile': 305, 'bust': 306, 'man': 307, 'waffle iron': 308, 'milk': 309, 'ring binder': 310, 'plate': 311, 'mobile phone': 312, 'baked goods': 313, 'mushroom': 314, 'crutch': 315, 'pitcher (container)': 316, 'mirror': 317, 'personal flotation device': 318, 'table tennis racket': 319, 'pencil case': 320, 'musical keyboard': 321, 'scoreboard': 322, 'briefcase': 323, 'kitchen knife': 324, 'nail (construction)': 325, 'tennis ball': 326, 'plastic bag': 327, 'oboe': 328, 'chest of drawers': 329, 'ostrich': 330, 'piano': 331, 'girl': 332, 'plant': 333, 'potato': 334, 'hair spray': 335, 'sports equipment': 336, 'pasta': 337, 'penguin': 338, 'pumpkin': 339, 'pear': 340, 'infant bed': 341, 'polar bear': 342, 'mixer': 343, 'cupboard': 344, 'jacuzzi': 345, 'pizza': 346, 'digital clock': 347, 'pig': 348, 'reptile': 349, 'rifle': 350, 'lipstick': 351, 'skateboard': 352, 'raven': 353, 'high heels': 354, 'red panda': 355, 'rose': 356, 'rabbit': 357, 'sculpture': 358, 'saxophone': 359, 'shotgun': 360, 'seafood': 361, 'submarine sandwich': 362, 'snowboard': 363, 'sword': 364, 'picture frame': 365, 'sushi': 366, 'loveseat': 367, 'ski': 368, 'squirrel': 369, 'tripod': 370, 'stethoscope': 371, 'submarine': 372, 'scorpion': 373, 'segway': 374, 'training bench': 375, 'snake': 376, 'coffee table': 377, 'skyscraper': 378, 'sheep': 379, 'television': 380, 'trombone': 381, 'tea': 382, 'tank': 383, 'taco': 384, 'telephone': 385, 'torch': 386, 'tiger': 387, 'strawberry': 388, 'trumpet': 389, 'tree': 390, 'tomato': 391, 'train': 392, 'tool': 393, 'picnic basket': 394, 'cooking spray': 395, 'trousers': 396, 'bowling equipment': 397, 'football helmet': 398, 'truck': 399, 'measuring cup': 400, 'coffeemaker': 401, 'violin': 402, 'vehicle': 403, 'handbag': 404, 'paper cutter': 405, 'wine': 406, 'weapon': 407, 'wheel': 408, 'worm': 409, 'wok': 410, 'whale': 411, 'zebra': 412, 'auto part': 413, 'jug': 414, 'pizza cutter': 415, 'cream': 416, 'monkey': 417, 'lion': 418, 'bread': 419, 'platter': 420, 'chicken': 421, 'eagle': 422, 'helicopter': 423, 'owl': 424, 'duck': 425, 'turtle': 426, 'hippopotamus': 427, 'crocodile': 428, 'toilet': 429, 'toilet paper': 430, 'squid': 431, 'clothing': 432, 'footwear': 433, 'lemon': 434, 'spider': 435, 'deer': 436, 'frog': 437, 'banana': 438, 'rocket': 439, 'wine glass': 440, 'countertop': 441, 'tablet computer': 442, 'waste container': 443, 'swimming pool': 444, 'dog': 445, 'book': 446, 'elephant': 447, 'shark': 448, 'candle': 449, 'leopard': 450, 'axe': 451, 'hand dryer': 452, 'soap dispenser': 453, 'porcupine': 454, 'flower': 455, 'canary': 456, 'cheetah': 457, 'palm tree': 458, 'hamburger': 459, 'maple': 460, 'building': 461, 'fish': 462, 'lobster': 463, 'garden asparagus': 464, 'furniture': 465, 'hedgehog': 466, 'airplane': 467, 'spoon': 468, 'otter': 469, 'bull': 470, 'oyster': 471, 'horizontal bar': 472, 'convenience store': 473, 'bomb': 474, 'bench': 475, 'ice cream': 476, 'caterpillar': 477, 'butterfly': 478, 'parachute': 479, 'orange': 480, 'antelope': 481, 'beaker': 482, 'moths and butterflies': 483, 'window': 484, 'closet': 485, 'castle': 486, 'jellyfish': 487, 'goose': 488, 'mule': 489, 'swan': 490, 'peach': 491, 'coconut': 492, 'seat belt': 493, 'raccoon': 494, 'chisel': 495, 'fork': 496, 'lamp': 497, 'camera': 498, 'squash (plant)': 499, 'racket': 500, 'human face': 501, 'human arm': 502, 'vegetable': 503, 'diaper': 504, 'unicycle': 505, 'falcon': 506, 'chime': 507, 'snail': 508, 'shellfish': 509, 'cabbage': 510, 'carrot': 511, 'mango': 512, 'jeans': 513, 'flowerpot': 514, 'pineapple': 515, 'drawer': 516, 'stool': 517, 'envelope': 518, 'cake': 519, 'dragonfly': 520, 'common sunflower': 521, 'microwave oven': 522, 'honeycomb': 523, 'marine mammal': 524, 'sea lion': 525, 'ladybug': 526, 'shelf': 527, 'watch': 528, 'candy': 529, 'salad': 530, 'parrot': 531, 'handgun': 532, 'sparrow': 533, 'van': 534, 'grinder': 535, 'spice rack': 536, 'light bulb': 537, 'corded phone': 538, 'sports uniform': 539, 'tennis racket': 540, 'wall clock': 541, 'serving tray': 542, 'kitchen & dining room table': 543, 'dog bed': 544, 'cake stand': 545, 'cat furniture': 546, 'bathroom accessory': 547, 'facial tissue holder': 548, 'pressure cooker': 549, 'kitchen appliance': 550, 'tire': 551, 'ruler': 552, 'luggage and bags': 553, 'microphone': 554, 'broccoli': 555, 'umbrella': 556, 'pastry': 557, 'grapefruit': 558, 'band-aid': 559, 'animal': 560, 'bell pepper': 561, 'turkey': 562, 'lily': 563, 'pomegranate': 564, 'doughnut': 565, 'glasses': 566, 'human nose': 567, 'pen': 568, 'ant': 569, 'car': 570, 'aircraft': 571, 'human hand': 572, 'skunk': 573, 'teddy bear': 574, 'watermelon': 575, 'cantaloupe': 576, 'dishwasher': 577, 'flute': 578, 'balance beam': 579, 'sandwich': 580, 'shrimp': 581, 'sewing machine': 582, 'binoculars': 583, 'rays and skates': 584, 'ipod': 585, 'accordion': 586, 'willow': 587, 'crab': 588, 'crown': 589, 'seahorse': 590, 'perfume': 591, 'alpaca': 592, 'taxi': 593, 'canoe': 594, 'remote control': 595, 'wheelchair': 596, 'rugby ball': 597, 'armadillo': 598, 'maracas': 599, 'helmet': 600}

data_dicts = {'vg':vg, 'coco':coco, 'open_images':open_images}
for data_name, data_dict in data_dicts.items():
    print ("Processing:", data_name)
    inverse_dict = {data_dict[name]:name for name in data_dict.keys()}
    vec = torchtext.vocab.GloVe()
    embeddings = vec.get_vecs_by_tokens([inverse_dict[x] for x in range(len(data_dict.keys()))], lower_case_backup=True)
    with open('embeddings/glove_{}'.format(data_name),'wb') as f:
        torch.save({'embeddings':embeddings}, f)

    embedding_arr = []
    for x in range(len(data_dict.keys())):
        embedding = torch.mean(vec.get_vecs_by_tokens(inverse_dict[x].split(' '), lower_case_backup=True), dim=0)
        embedding_arr.append(embedding)

    with open('embeddings/glove_mean_{}'.format(data_name),'wb') as f:
        torch.save({'embeddings':torch.stack(embedding_arr, dim=0)}, f)
